version: "3.9"

services:
  docs-builder:
    build: ./dockerfiles/app
    container_name: docs-builder
    #restart: unless-stopped
    volumes:
      - ./:/dcsp
    env_file:
      - .env
    working_dir: /dcsp/app
    entrypoint: bash PID_1.sh
    #TODO: need to run as non-root at some point
    networks: 
      - cross-site

  nginx:
    image: nginx:alpine
    container_name: nginx
    #restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
      - "9000:9000"
    volumes:
      - ./app/dcsp/app/static/:/dcsp/app/dcsp/app/static/
      - ./nginx/development/:/etc/nginx/
      - ./logs/nginx/:/var/log/nginx/
    depends_on:
      - docs-builder
    networks: 
      - cross-site

#  certbot:
#    image: certbot/certbot:latest
#    volumes:
#      - /var/certbot/conf:/etc/letsencrypt/:rw
#      - /var/certbot/www/:/var/www/certbot/:rw
#    depends_on:
#      - nginx
#    networks: 
#      - cross-site


networks:
  cross-site:
    driver: bridge  